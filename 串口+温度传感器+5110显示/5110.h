/////////////////////////////////////////////////////////////
//nokia 5110驱动
//2015/3/23
//biopunk
/////////////////////////////////////////////////////////////
#include<reg52.h>
//----------------------------------------------------------
//引脚定义
//----------------------------------------------------------
sbit ce=P0^1;
sbit rst=P0^0;
sbit dc=P0^2;
sbit sdin=P0^3;
sbit sclk=P0^4;
//
void delay_1us(void);
void LCD_init(void);
void LCD_clear(void);
void LCD_set_XY(unsigned char X,unsigned char Y);
void LCD_write_char(unsigned char c);
void LCD_write_english_string(unsigned char X,unsigned char Y,char *s);
void LCD_write_byte(unsigned char dat,unsigned char command);
void LCD_write_num(unsigned char X,unsigned char Y,int c,int t);
void LCD_write_n(int c);
//----------------------------------------------------------
//字模
//----------------------------------------------------------
code unsigned char font6x8[92][6]=
{
	{0x00,0x00,0x00,0x00,0x00,0x00},// 空
	{0x00,0x00,0x00,0x2f,0x00,0x00},//!
	{0x00,0x00,0x07,0x00,0x07,0x00},
	{0x00,0x14,0x7f,0x14,0x2a,0x14},
	{0x00,0x24,0x2a,0x7f,0x2a,0x12},
	{0x00,0x62,0x64,0x08,0x13,0x23},
	{0x00,0x36,0x49,0x55,0x20,0x50},
	{0x00,0x00,0x05,0x03,0x00,0x00},
	{0x00,0x00,0x1c,0x22,0x41,0x00},
	{0x00,0x00,0x22,0x41,0x1c,0x00},
	{0x00,0x14,0x08,0x3e,0x08,0x14},
	{0x00,0x08,0x08,0x3e,0x08,0x08},
	{0x00,0x00,0x00,0xa0,0x60,0x00},
	{0x00,0x08,0x08,0x08,0x08,0x08},
	{0x00,0x00,0x60,0x60,0x00,0x00},
	{0x00,0x20,0x10,0x05,0x04,0x02},
	{0x00,0x3e,0x51,0x49,0x45,0x3e},//0
	{0x00,0x00,0x42,0x7f,0x40,0x00},//1
	{0x00,0x42,0x61,0x51,0x49,0x46},//2
	{0x00,0x21,0x41,0x45,0x4b,0x31},//3
	{0x00,0x18,0x14,0x12,0x7f,0x10},//4
	{0x00,0x27,0x45,0x45,0x45,0x39},//5
	{0x00,0x3c,0x4a,0x49,0x49,0x30},//6
	{0x00,0x01,0x71,0x09,0x05,0x03},//7
	{0x00,0x36,0x49,0x49,0x49,0x36},//8
	{0x00,0x06,0x49,0x49,0x29,0x1e},//9
	{0x00,0x00,0x36,0x36,0x00,0x00},//:
	{0x00,0x00,0x56,0x36,0x00,0x00},//;
	{0x00,0x08,0x14,0x22,0x41,0x00},//<
	{0x00,0x14,0x14,0x14,0x14,0x14},//=
	{0x00,0x00,0x41,0x22,0x14,0x08},//>
	{0x00,0x02,0x01,0x51,0x09,0x06},//?
	{0x00,0x32,0x49,0x59,0x51,0x3e},
	{0x00,0x7c,0x12,0x11,0x12,0x7c},//A
	{0x00,0x7f,0x49,0x49,0x49,0x36},//B
	{0x00,0x3e,0x41,0x41,0x41,0X22},//C
	{0x00,0x7f,0x41,0x41,0x22,0x1c},//D
	{0x00,0x7f,0x49,0x49,0x49,0x41},//E
	{0x00,0x7f,0x09,0x09,0x09,0x01},//F
	{0x00,0x3e,0x41,0x49,0x49,0x7a},//G
	{0x00,0x7f,0x08,0x08,0x08,0x7f},//H
	{0x00,0x00,0x41,0x7f,0x41,0x00},//I
	{0x00,0x20,0x40,0x41,0x3f,0x01},//J
	{0x00,0x7f,0x08,0x14,0x22,0x41},//K
	{0x00,0x7f,0x40,0x40,0x40,0x40},//L
	{0x00,0x7f,0x02,0x0c,0x02,0x7f},//M
	{0x00,0x7f,0x04,0x08,0x10,0x7f},//N
	{0x00,0x3e,0x41,0x41,0x41,0x3e},//O
	{0x00,0x7f,0x09,0x09,0x09,0x06},//P
	{0x00,0x3e,0x41,0x51,0x21,0x5e},//Q
	{0x00,0x7f,0x09,0x19,0x29,0x26},//R
	{0x00,0x46,0x49,0x49,0x49,0x31},//S
	{0x00,0x01,0x01,0x7f,0x01,0x01},//T
	{0x00,0x3f,0x40,0x40,0x40,0x3f},//U
	{0x00,0x1f,0x20,0x40,0x20,0x1f},//V
	{0x00,0x3f,0x40,0x38,0x40,0x3f},//W
	{0x00,0x63,0x14,0x08,0x14,0x63},//X
	{0x00,0x07,0x08,0x70,0x08,0x07},//Y
	{0x00,0x61,0x51,0x49,0x45,0x43},//Z
	{0x00,0x00,0x7f,0x41,0x41,0x00},
	{0x00,0x55,0x2a,0x55,0x2a,0x55},
	{0x00,0x00,0x41,0x41,0x7f,0x00},
	{0x00,0x04,0x02,0x01,0x02,0x04},
	{0x00,0x40,0x40,0x40,0x40,0x40},
	{0x00,0x00,0x01,0x02,0x04,0x00},
	{0x00,0x20,0x54,0x54,0x54,0x78},
	{0x00,0x7f,0x48,0x44,0x44,0x38},
	{0x00,0x38,0x44,0x44,0x44,0x20},
	{0x00,0x38,0x44,0x44,0x48,0x7f},
	{0x00,0x38,0x54,0x54,0x54,0x18},
	{0x00,0x08,0x7e,0x09,0x01,0x02},
	{0x00,0x18,0xa4,0xa4,0xa4,0x7c},
	{0x00,0x7f,0x08,0x04,0x04,0x78},
	{0x00,0x00,0x44,0x7d,0x40,0x00},
	{0x00,0x40,0x80,0x84,0x7d,0x00},
	{0x00,0x7f,0x10,0x28,0x44,0x00},
	{0x00,0x7c,0x04,0x18,0x04,0x78},
	{0x00,0x7c,0x08,0x04,0x04,0x78},
	{0x00,0x38,0x44,0x44,0x44,0x38},
	{0x00,0xfc,0x24,0x24,0x24,0x18},
	{0x00,0x18,0x24,0x24,0x18,0xfc},
	{0x00,0x7c,0x08,0x04,0x04,0x08},
	{0x00,0x48,0x54,0x54,0x54,0x20},
	{0x00,0x04,0x3f,0x44,0x40,0x20},
	{0x00,0x3c,0x40,0x40,0x20,0x7c},
	{0x00,0x1c,0x20,0x40,0x20,0x1c},
	{0x00,0x3c,0x40,0x30,0x40,0x3c},
	{0x00,0x44,0x28,0x10,0x28,0x44},
	{0x00,0x1c,0xa0,0xa0,0xa0,0x7c},
	{0x00,0x44,0x64,0x54,0x4c,0x44},
	{0x14,0x14,0x14,0x14,0x14,0x14},
};
//////////////////////////////////////////////////////
void delay_1us()
{
	unsigned int i;

	for(i=0;i<1000;i++);
}
//////////////////////////////////////////////////////
void LCD_init(void)
{
	rst=0;
	delay_1us();
	rst=1;
	ce=0;
	delay_1us();
	ce=1;
	delay_1us();
	LCD_write_byte(0x21,0);
	LCD_write_byte(0xc8,0);
	LCD_write_byte(0x06,0);
	LCD_write_byte(0x13,0);	 
	LCD_write_byte(0x20,0);
	LCD_clear();
	LCD_write_byte(0x0c,0);
	ce=0;
}
//////////////////////////////////////////////////////
void LCD_clear(void)
{
 	unsigned int i;
	LCD_write_byte(0x0c,0);
	LCD_write_byte(0x80,0);

	for(i=0;i<504;i++)
	LCD_write_byte(0,1);
}
/////////////////////////////////////////////////////////
void LCD_set_XY(unsigned char X,unsigned char Y)
{
	LCD_write_byte(0x40|Y,0);
	LCD_write_byte(0x80|X,0);
}
/////////////////////////////////////////////////////////
void LCD_write_char(unsigned char c)
{
	unsigned char line;
	c-=32;
	for(line=0;line<6;line++)
		LCD_write_byte(font6x8[c][line],1);
}
/////////////////////////////////////////////////////////////
void LCD_write_english_string(unsigned char X,unsigned char Y,char *s)
{
	X*=6;
	LCD_set_XY(X,Y);
	while(*s)
	{
		LCD_write_char(*s);
		s++;
	}
}
void LCD_write_num(unsigned char X,unsigned char Y,int c,int t)
{
	int f;
	t-=1;
	t=t*6;
	X*=6;
	while(c!=0){f=c%10;LCD_set_XY(X+t,Y);LCD_write_n(f);t-=6;c=c/10;}
}
///////////////////////////////////////////////////////////////
void LCD_write_byte(unsigned char dat,unsigned char command)
{
	unsigned char i;
	ce=0;
	if(command==0)
	  dc=0;
	else
	  dc=1;
	  	for(i=0;i<8;i++)
		{
			if(dat&0x80)
			  sdin=1;
		    else
			  sdin=0;
			sclk=0;
			dat=dat<<1;
			sclk=1;
		}
}
void LCD_write_n(int c)
{
	unsigned char line;
	c+=16;
	for(line=0;line<6;line++) {
		LCD_write_byte(font6x8[c][line],1);}
}
