///////////////////////////////////////////////////////////////////////
//串行发射和接收【与pc通讯】
//用定时器2产生波特率
//文件名：uart_com_temp.h
////////////////////////////////////////////////////////////////////////
//定时器2在reg52.h中无定义，所以重新定义
/////////////////////////////////////////////////////////////////////////
//T2 EXTENSION
/////////////////////////////////////////////////////////////////////////
#include<reg52.h>

unsigned char chComDat=0x41;
////////////////////////////////////////////////////////////////////////
//函数名称：InitUartComm
//函数功能：初始化并启动串行口
//入口参数：fExtal（晶振大小，lBaudRate（波特率） 
//出口参数：无
////////////////////////////////////////////////////////////////////////
void InitUartComm(float fExtal,long lBaudRate)
{
	unsigned long nM,nInt;
	unsigned char cT2H1,cT2L1;
	float fF1;

	fF1=(fExtal*1000000)/(32*lBaudRate);
	nInt=fF1;
	nM=65536-nInt;

	cT2L1=nM;
	nM=nM>>8;
	cT2H1=nM;

	T2CON=0X34;
	RCAP2H=cT2H1;
	RCAP2L=cT2L1;
	TCLK=1;
	TR2=1;
	SCON=0X50;
	PCON=0X00;
}
///////////////////////////////////////////////////////////////////////
//函数名称：Send_Comm
//函数功能：串口数据发送子程序
//入口参数：chComDat[传送要发送的串行数据]
//出口参数：无
///////////////////////////////////////////////////////////////////////
void Send_Comm(unsigned char chComDat)
{
	SBUF=chComDat;
	TI=0;
}
/////////////////////////////////////////////////////////////////////////
//函数名称：Rcv_Comm
//函数功能：串行口接收子程序
//入口参数：无
//出口参数：chComDat[接收的串行数据]
/////////////////////////////////////////////////////////////////////////
unsigned char Rcv_Comm()
{
	if(RI)
	{
		chComDat=SBUF;
		RI=0;
	}
	return chComDat;
}


